<!doctype html>
<html>
<head>
    <link rel="icon" href='images/icon.png'/>
    <title>My fancy game</title>
</head>
<body>
<canvas id="canvas" style="border:1px solid #000"></canvas>
 
<script>
    (function() {
    var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
    window.requestAnimationFrame = requestAnimationFrame;
})();
 
var canvas = document.getElementById("canvas"),
    ctx = canvas.getContext("2d"),
    width = 1000,
    height = 400,
    player = {
      x : width/2,
      y : height - 50,
      width : 35,
      height : 50,
      speed: 3,
      velX: 0,
      velY: 0,
      jumping: false
    },
    keys = [],
    friction = 0.8,
    gravity = 0.17;
    
    var boxes = [];
 
    // dimensions
    boxes.push({
        x: 64,
        y: height - 64,
        width: 64,
        height: 32
    });
	
	boxes.push({
        x: 400,
        y: height - 64,
        width: 64,
        height: 64
    });
 
    canvas.width = width;
    canvas.height = height;
	
	function render()
	{
		ctx.clearRect(0,0,width,height);
        
		ctx.fillStyle = "black";
		ctx.beginPath();
        for (var i = 0; i < boxes.length; i++) {
                ctx.rect(boxes[i].x, boxes[i].y, boxes[i].width, boxes[i].height);
            }
		ctx.fill();
		ctx.fillStyle = "red";
		ctx.fillRect(player.x, player.y, player.width, player.height);
		requestAnimationFrame(update);
	}
	
	function updateSprites()
	{
		
	}
	
	function updateGameWorld()
	{
		player.velX *= friction;
		if(player.jumping)
        player.velY += gravity;
		
		oldX = player.x;
		oldY = player.y;
		
        player.x += player.velX;
        player.y += player.velY;
	
		player.jumping = true;
		
		if (player.x >= width - player.width) {
            player.x = width - player.width;
        } else if (player.x <= 0) {         
            player.x = 0;     
        }
		
        for (var i = 0; i < boxes.length; i++) {
			
			var oldDown = boxes[i].y + boxes[i].height <= oldY;
			var oldUp = boxes[i].y >= oldY + player.height;
			var oldLeft = boxes[i].x >= oldX + player.width;
			var oldRight = boxes[i].x + boxes[i].width <= oldX;
			
			var down = boxes[i].y + boxes[i].height <= player.y;
			var up = boxes[i].y >= player.y + player.height;
			var left = boxes[i].x >= player.x + player.width;
			var right = boxes[i].x + boxes[i].width <= player.x;
			
			if(down || up || left || right)
				continue;
			
			if(!up && boxes[i].y > player.y && player.velY > 0){
				player.y = boxes[i].y - player.height;
				player.velY = 0;
				player.jumping = false;
				continue;
			}
			
			if(!down && boxes[i].y + boxes[i].height < player.y + player.height && player.velY < 0)
			{ 
				player.y = boxes[i].y + boxes[i].height;
				player.velY = 0;
				jumping = false;
			}
			
			
			left = boxes[i].x >= player.x + player.width;
			right = boxes[i].x + boxes[i].width <= player.x;
			
			if(!left && boxes[i].x > player.x)
			{
				player.x = boxes[i].x - player.width;
				player.velX = 0;
			}
			
			if(!right && boxes[i].x + boxes[i].width <= player.x + player.width)
			{
				player.x = boxes[i].x + boxes[i].width;
				player.velX = 0;
			}
		}
		
		if(player.y >= height - player.height){
            player.y = height - player.height;
            player.jumping = false;
        }
        
        
	}
	
	function updateControls()
	{
		if (keys[38] || keys[32]) {
            // up arrow or space
          if(!player.jumping){
           player.jumping = true;
           player.velY = -player.speed*2;
          }
        }
        if (keys[39]) {
            // right arrow
            if (player.velX < player.speed) {             
                player.velX++;         
             }     
        }     
        if (keys[37]) {         
            // left arrow         
            if (player.velX > -player.speed) {
                player.velX--;
            }
        }
	}
	
    function update(){
      // check keys
        
        updateControls();
		updateGameWorld();
		updateSprites();
		render();
    }
    //setup event listeners
    document.body.addEventListener("keydown", function(e) {
        keys[e.keyCode] = true;
    });
    document.body.addEventListener("keyup", function(e) {
        keys[e.keyCode] = false;
    });
    //instead window.onload
    window.addEventListener("load",function(){
        update();
    });
    
</script>
</body>
</html>