<!doctype html>
<html>
<head>
    <link rel="icon" href='images/icon.png'/>
    <title>My fancy game</title>
</head>
<body>
<canvas id="canvas" style="border:1px solid #000"></canvas>
 
<script>
    (function() {
    var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
    window.requestAnimationFrame = requestAnimationFrame;
})();
    
    document.getElementById('canvas').style.backgroundImage = "url('images/walk/background.jpg')";
    
    var backAudio = new Audio('audio/backMusic.mp3');
    backAudio.play();
    var jumpAudio = new Audio('audio/jump.wav')
 
var canvas = document.getElementById("canvas"),
    ctx = canvas.getContext("2d"),
    width = 1135,
    height = 568,
    player = {
      x : width/2,
      y : height - 50,
      width : 40,
      height : 50,
      speed: 3,
      velX: 0,
      velY: 0,
      jumping: false,
      mirror: true
    },
    keys = [],
    friction = 0.85,
    gravity = 0.4;
    
    var boxes = [];
 
    // dimensions
    boxes.push({
        x: 64,
        y: height - 200,
        width: 64,
        height: 32
    });
	
	boxes.push({
        x: 400,
        y: height - 200,
        width: 64,
        height: 64
    });
 
        var move = new Array();
        var moveMirror = new Array();
        var numOfSpritesMove = 4;
        for(var i = 0; i < numOfSpritesMove; i++){
            move[i] = new Image();
            move[i].src = 'images/walk/'.concat(i + 1).concat('.png');
            moveMirror[i] = new Image();
            moveMirror[i].src = 'images/walk/'.concat(i + 1).concat('mirror.png');
        }
    
    canvas.width = width;
    canvas.height = height;
	
	function render()
	{
		ctx.clearRect(0,0,width,height);
        ctx.save();
        drawBoxes();
		
        //drawMirroredCharacter();
        if(player.mirror){
            drawCharacter();
        } else {
            drawMirroredCharacter();
        }
		
		
	}
    
    function drawBoxes(){
        ctx.fillStyle = "black";
		ctx.beginPath();
        for (var i = 0; i < boxes.length; i++) {
                ctx.rect(boxes[i].x, boxes[i].y, boxes[i].width, boxes[i].height);
            }
		ctx.fill();
    }
    
    function drawCharacter(){
        ctx.drawImage(move[0], player.x, player.y, player.width, player.height);
    }

	function drawMirroredCharacter(){
        ctx.drawImage(moveMirror[0], player.x, player.y, player.width, player.height);
    }
    
	function updateSprites()
	{   
        
	}
	
	function updateGameWorld()
	{
		player.jumping = true;
		
        for (var i = 0; i < boxes.length; i++) {
			
			var down = boxes[i].y + boxes[i].height <= player.y;
			var up = boxes[i].y >= player.y + player.height;
			var left = boxes[i].x >= player.x + player.width;
			var right = boxes[i].x + boxes[i].width <= player.x;
			
			if(down || up || left || right)
				continue;
			
			if(!up && boxes[i].y > player.y && player.velY > 0){
				player.y = boxes[i].y - player.width;
				player.velY = 0;
				player.jumping = false;
				continue;
			}
			
			if(!down && boxes[i].y + boxes[i].height < player.y + player.height && player.velY < 0)
			{ 
				player.y = boxes[i].y + boxes[i].height;
				player.velY = 0;
				jumping = false;
				continue;
			}
			
			if(!left && boxes[i].x > player.x)
			{
				player.x = boxes[i].x - player.height;
				player.velX = 0;
			}
			
			if(!right && boxes[i].x <= player.x)
			{
				player.x = boxes[i].x + boxes[i].width;
				player.velX = 0;
			}
		}
		
		player.velX *= friction;
		if(player.jumping)
        player.velY += gravity;
		
        player.x += player.velX;
        player.y += player.velY;
		
        if (player.x >= width - player.width) {
            player.x = width - player.width;
        } else if (player.x <= 0) {         
            player.x = 0;     
        }    
        if(player.y >= height - player.height - 130){
            player.y = height - player.height - 130;
            player.jumping = false;
        }
	}
	
	function updateControls()
	{
		if (keys[38] || keys[32]) {
            // up arrow or space
          if(!player.jumping){
           player.jumping = true;
           player.velY = -player.speed*4;
           jumpAudio.play();
          }
        }
        if (keys[39]) {
            // right arrow
            if (player.velX < player.speed) {             
                player.velX++; 
                player.mirror = true;
             }     
        }     
        if (keys[37]) {         
            // left arrow         
            if (player.velX > -player.speed) {
                player.velX--;
                player.mirror = false;
            }
        }
	}
	
    function update(){
      // check keys
        
        updateControls();
		updateGameWorld();
		updateSprites();
		render();
        
        requestAnimationFrame(update);
    }
    //setup event listeners
    document.body.addEventListener("keydown", function(e) {
        keys[e.keyCode] = true;
    });
    document.body.addEventListener("keyup", function(e) {
        keys[e.keyCode] = false;
    });
    //instead window.onload
    window.addEventListener("load",function(){
        update();
    });
    
</script>
</body>
</html>