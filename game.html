<!doctype html>
<html>
<head>
    <link rel="icon" href='images/icon.png'/>
    <title>My fancy game</title>
</head>
<body>
<canvas id="canvas" style="border:1px solid #000"></canvas>
 
<script>
    (function() {
    var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
    window.requestAnimationFrame = requestAnimationFrame;
})();
    
    document.getElementById('canvas').style.backgroundImage = "url('images/walk/background.jpg')";
    
    var backAudio = new Audio('audio/backMusic.mp3');
    backAudio.loop = true;
    
    backAudio.play();
    var jumpAudio = new Audio('audio/jump.wav')
 
var canvas = document.getElementById("canvas"),
    ctx = canvas.getContext("2d"),
    width = 1135,
    height = 568,
    player = {
      x : width/2,
      y : height - 50,
      width : 40,
      height : 50,
      speed: 3,
      velX: 0,
      velY: 0,
      jumping: false,
      mirror: true
    },
    keys = [],
    friction = 0.85,
    gravity = 0.4;
    
	var collision = false;
	
    var boxes = [];
 
    // dimensions
    boxes.push({
        x: width/2 + 50,
        y: height - 200,
        width: 198,
        height: 38
    });
	
	boxes.push({
        x: width/2 + 250,
        y: height - 300,
        width: 198,
        height: 38
    });
 
        var move = new Array();
        var moveMirror = new Array();
        var numOfSpritesMove = 4;
        for(var i = 0; i < numOfSpritesMove; i++){
            move[i] = new Image();
            move[i].src = 'images/walk/'.concat(i + 1).concat('.png');
            moveMirror[i] = new Image();
            moveMirror[i].src = 'images/walk/'.concat(i + 1).concat('mirror.png');
        }
        var block = new Image();
        block.src = 'images/walk/block.png';
    
    canvas.width = width;
    canvas.height = height;
	
	function render()
	{
		ctx.clearRect(0,0,width,height);
        ctx.save();
        drawBoxes();
		
        //drawMirroredCharacter();
        if(player.mirror){
            drawCharacter();
        } else {
            drawMirroredCharacter();
        }
		
		
	}
    
    function drawBoxes(){
//        ctx.fillStyle = "black";
//		if(collision)
//			ctx.fillStyle = "red";
//		ctx.beginPath();
        for (var i = 0; i < boxes.length; i++) {
//                ctx.rect(boxes[i].x, boxes[i].y, boxes[i].width, boxes[i].height);
            ctx.drawImage(block, boxes[i].x, boxes[i].y, boxes[i].width, boxes[i].height);
            }
//		ctx.fill();
    }
    
    function drawCharacter(){
        ctx.drawImage(move[0], player.x, player.y, player.width, player.height);
    }

	function drawMirroredCharacter(){
        ctx.drawImage(moveMirror[0], player.x, player.y, player.width, player.height);
    }
    
	function updateSprites()
	{   
        
	}
	
	function updateGameWorld()
	{
		player.velX *= friction;
		if(player.jumping)
        player.velY += gravity;
		
		
        player.x += player.velX;
        player.y += player.velY;
	
		player.jumping = true;
		
		if (player.x >= width - player.width) {
            player.x = width - player.width;
        } else if (player.x <= 0) {         
            player.x = 0;     
        }
		
		collision = false;
		
		for (var i = 0; i < boxes.length; i++) {
			var vecX = (player.x + (player.width / 2)) - (boxes[i].x + (boxes[i].width / 2));
			var vecY = (player.y + (player.height / 2)) - (boxes[i].y + (boxes[i].height / 2));
			
			var hHeight = (player.height + boxes[i].height)/2;
			var hWidth= (player.width + boxes[i].width)/2;
			
			if (Math.abs(vecX) < hWidth && Math.abs(vecY) < hHeight) {         // figures out on which side we are colliding (top, bottom, left, or right)         var oX = hWidths - Math.abs(vX),             oY = hHeights - Math.abs(vY);         if (oX >= oY) {
				var oX = hWidth - Math.abs(vecX),             
					oY = hHeight - Math.abs(vecY);         
				if (oX >= oY) {
					if (vecY > 0) { // top
						
						collision = true;
						player.y += oY;
						player.velY = 0;
					} else { // bottom
						
						player.jumping = false;
						player.y -= oY;
						player.velY = 0;
					}
				} else { 
			
					if (vecX > 0) {// left
						
						player.x += oX;
						player.velX = 0;
					} else { // right
					
						player.x -= oX;
						player.velX = 0;
					}
				}
			}
		}
		
		if(player.y >= height - player.height - 130){
            player.y = height - player.height - 130;
            player.jumping = false;
        }
        
        
	}
	
	function updateControls()
	{
		if (keys[38] || keys[32]) {
            // up arrow or space
          if(!player.jumping){
           player.jumping = true;
           player.velY = -player.speed*4;
           jumpAudio.play();
          }
        }
        if (keys[39]) {
            // right arrow
            if (player.velX < player.speed) {             
                player.velX++; 
                player.mirror = true;
             }     
        }     
        if (keys[37]) {         
            // left arrow         
            if (player.velX > -player.speed) {
                player.velX--;
                player.mirror = false;
            }
        }
	}
	
    function update(){
      // check keys
        
        updateControls();
		updateGameWorld();
		updateSprites();
		render();
        
        requestAnimationFrame(update);
    }
    //setup event listeners
    document.body.addEventListener("keydown", function(e) {
        keys[e.keyCode] = true;
    });
    document.body.addEventListener("keyup", function(e) {
        keys[e.keyCode] = false;
    });
    //instead window.onload
    window.addEventListener("load",function(){
        update();
    });
    
</script>
</body>
</html>